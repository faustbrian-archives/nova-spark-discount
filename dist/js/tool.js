!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){n(1),t.exports=n(6)},function(t,e,n){Nova.booting(function(t,e,r){t.component("nova-spark-discount",n(2))})},function(t,e,n){var r=n(3)(n(4),n(5),!1,null,null,null);t.exports=r.exports},function(t,e){t.exports=function(t,e,n,r,o,i){var s,a=t=t||{},u=typeof t.default;"object"!==u&&"function"!==u||(s=t,a=t.default);var c,l="function"==typeof a?a.options:a;if(e&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0),n&&(l.functional=!0),o&&(l._scopeId=o),i?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),r&&r.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(i)},l._ssrRegister=c):r&&(c=r),c){var f=l.functional,d=f?l.render:l.beforeCreate;f?(l._injectStyles=c,l.render=function(t,e){return c.call(e),d(t,e)}):l.beforeCreate=d?[].concat(d,c):[c]}return{esModule:s,exports:a,options:l}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={globalLocale:"en-US",globalFormat:"$0,0.00",globalRoundingMode:"HALF_EVEN",globalFormatRoundingMode:"HALF_AWAY_FROM_ZERO",globalExchangeRatesApi:{endpoint:void 0,headers:void 0,propertyPath:void 0}},o={normalizePrecision:function(t){var e=t.reduce(function(t,e){return Math.max(t.getPrecision(),e.getPrecision())});return t.map(function(t){return t.getPrecision()!==e?t.convertPrecision(e):t})}},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function s(t){return!isNaN(parseInt(t))&&isFinite(t)}function a(t){return t%2==0}function u(t){return s(t)&&!Number.isInteger(t)}function c(t){return Math.abs(t)%1==.5}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(n,r){var o=Object.assign(new XMLHttpRequest,{onreadystatechange:function(){4===o.readyState&&(o.status>=200&&o.status<400?n(JSON.parse(o.responseText)):r(new Error(o.statusText)))},onerror:function(){r(new Error("Network error"))}});o.open("GET",t,!0),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in e)t.setRequestHeader(n,e[n])}(o,e.headers),o.send()})}function f(t){return void 0===t}function d(){var t={HALF_ODD:function(t){var e=Math.round(t);return c(t)&&a(e)?e-1:e},HALF_EVEN:function(t){var e=Math.round(t);return c(t)?a(e)?e:e-1:e},HALF_UP:function(t){return Math.round(t)},HALF_DOWN:function(t){return c(t)?Math.floor(t):Math.round(t)},HALF_TOWARDS_ZERO:function(t){return c(t)?Math.sign(t)*Math.floor(Math.abs(t)):Math.round(t)},HALF_AWAY_FROM_ZERO:function(t){return c(t)?Math.sign(t)*Math.ceil(Math.abs(t)):Math.round(t)}};return{add:function(t,e){return t+e},subtract:function(t,e){return t-e},multiply:function(t,e){return u(t)||u(e)?function(t,e){var n=function(t){return Math.pow(10,function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0).toString().split(".")[1];return t?t.length:0}(t))},r=Math.max(n(t),n(e));return Math.round(t*r)*Math.round(e*r)/(r*r)}(t,e):t*e},divide:function(t,e){return t/e},modulo:function(t,e){return t%e},round:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"HALF_EVEN";return t[n](e)}}}var m=d();function h(t){var e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments[1];for(var n in e)t=t.replace("{{"+n+"}}",e[n]);return t};return{getExchangeRate:function(n,r){return(o=t.endpoint,!Boolean(o)||"object"!==(void 0===o?"undefined":i(o))&&"function"!=typeof o||"function"!=typeof o.then?function(n,r){return l(e(t.endpoint,{from:n,to:r}),{headers:t.headers})}(n,r):t.endpoint).then(function(o){return function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".",r={};return Object.entries(e).forEach(function(e){if("object"===i(e[1])){var o=t(e[1]);Object.entries(o).forEach(function(t){r[e[0]+n+t[0]]=t[1]})}else r[e[0]]=e[1]}),r}(o)[e(t.propertyPath,{from:n,to:r})]});var o}}}function v(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Error;if(!t)throw e}function p(t){v(function(t){return s(t)&&t<=100&&t>=0}(t),new RangeError("You must provide a numeric value between 0 and 100."))}function g(t){v(Number.isInteger(t),new TypeError("You must provide an integer."))}var _=d(),y=Object.assign(function t(e){var n=Object.assign({},{amount:t.defaultAmount,currency:t.defaultCurrency,precision:t.defaultPrecision},e),r=n.amount,o=n.currency,i=n.precision;g(r),g(i);var s=t.globalLocale,a=t.globalFormat,u=t.globalRoundingMode,c=t.globalFormatRoundingMode,l=Object.assign({},t.globalExchangeRatesApi),d=function(e){var n=Object.assign({},Object.assign({},{amount:r,currency:o,precision:i},e),Object.assign({},{locale:this.locale},e));return Object.assign(t({amount:n.amount,currency:n.currency,precision:n.precision}),{locale:n.locale})},y=function(t){v(this.hasSameCurrency(t),new TypeError("You must provide a Dinero instance with the same currency."))};return{getAmount:function(){return r},getCurrency:function(){return o},getLocale:function(){return this.locale||s},setLocale:function(t){return d.call(this,{locale:t})},getPrecision:function(){return i},convertPrecision:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c;return g(t),d.call(this,{amount:_.round(_.multiply(this.getAmount(),Math.pow(10,_.subtract(t,this.getPrecision()))),e),precision:t})},add:function(e){y.call(this,e);var n=t.normalizePrecision([this,e]);return d.call(this,{amount:_.add(n[0].getAmount(),n[1].getAmount()),precision:n[0].getPrecision()})},subtract:function(e){y.call(this,e);var n=t.normalizePrecision([this,e]);return d.call(this,{amount:_.subtract(n[0].getAmount(),n[1].getAmount()),precision:n[0].getPrecision()})},multiply:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return d.call(this,{amount:_.round(_.multiply(this.getAmount(),t),e)})},divide:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u;return d.call(this,{amount:_.round(_.divide(this.getAmount(),t),e)})},percentage:function(t){return p(t),this.multiply(_.divide(t,100))},allocate:function(t){var e=this;!function(t){v(function(t){return t.length>0&&t.every(function(t){return t>0})}(t),new TypeError("You must provide a non-empty array of numeric values greater than 0."))}(t);for(var n=t.reduce(function(t,e){return _.add(t,e)}),r=this.getAmount(),o=t.map(function(t){var o=Math.floor(_.divide(_.multiply(e.getAmount(),t),n));return r=_.subtract(r,o),d.call(e,{amount:o})}),i=0;r>0;i++)o[i]=o[i].add(d.call(this,{amount:1})),r=_.subtract(r,1);return o},convert:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.endpoint,o=void 0===r?l.endpoint:r,i=n.propertyPath,s=void 0===i?l.propertyPath||"rates.{{to}}":i,a=n.headers,c=void 0===a?l.headers:a,m=n.roundingMode,p=void 0===m?u:m,g=Object.assign({},{endpoint:o,propertyPath:s,headers:c,roundingMode:p});return h(g).getExchangeRate(this.getCurrency(),t).then(function(n){return v(!f(n),new TypeError('No rate was found for the destination currency "'+t+'".')),d.call(e,{amount:_.round(_.multiply(e.getAmount(),parseFloat(n)),g.roundingMode),currency:t})})},equalsTo:function(t){return this.hasSameAmount(t)&&this.hasSameCurrency(t)},lessThan:function(e){y.call(this,e);var n=t.normalizePrecision([this,e]);return n[0].getAmount()<n[1].getAmount()},lessThanOrEqual:function(e){y.call(this,e);var n=t.normalizePrecision([this,e]);return n[0].getAmount()<=n[1].getAmount()},greaterThan:function(e){y.call(this,e);var n=t.normalizePrecision([this,e]);return n[0].getAmount()>n[1].getAmount()},greaterThanOrEqual:function(e){y.call(this,e);var n=t.normalizePrecision([this,e]);return n[0].getAmount()>=n[1].getAmount()},isZero:function(){return 0===this.getAmount()},isPositive:function(){return this.getAmount()>=0},isNegative:function(){return this.getAmount()<0},hasSubUnits:function(){return 0!==_.modulo(this.getAmount(),Math.pow(10,i))},hasCents:function(){return 0!==_.modulo(this.getAmount(),Math.pow(10,i))},hasSameCurrency:function(t){return this.getCurrency()===t.getCurrency()},hasSameAmount:function(e){var n=t.normalizePrecision([this,e]);return n[0].getAmount()===n[1].getAmount()},toFormat:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c,n=function(t){var e=/^(?:(\$|USD)?0(?:(,)0)?(\.)?(0+)?|0(?:(,)0)?(\.)?(0+)?\s?(dollar)?)$/gm.exec(t);return{getMatches:function(){return null!==e?e.slice(1).filter(function(t){return!f(t)}):[]},getMinimumFractionDigits:function(){var t=function(t){return"."===t};return f(this.getMatches().find(t))?0:this.getMatches()[m.add(this.getMatches().findIndex(t),1)].split("").length},getCurrencyDisplay:function(){return{USD:"code",dollar:"name",$:"symbol"}[this.getMatches().find(function(t){return"USD"===t||"dollar"===t||"$"===t})]},getStyle:function(){return f(this.getCurrencyDisplay(this.getMatches()))?"decimal":"currency"},getUseGrouping:function(){return!f(this.getMatches().find(function(t){return","===t}))}}}(t);return this.toRoundedUnit(n.getMinimumFractionDigits(),e).toLocaleString(this.getLocale(),{currencyDisplay:n.getCurrencyDisplay(),useGrouping:n.getUseGrouping(),minimumFractionDigits:n.getMinimumFractionDigits(),style:n.getStyle(),currency:this.getCurrency()})},toUnit:function(){return _.divide(this.getAmount(),Math.pow(10,i))},toRoundedUnit:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c,n=Math.pow(10,t);return _.divide(_.round(_.multiply(this.toUnit(),n),e),n)},toObject:function(){return{amount:r,currency:o,precision:i}},toJSON:function(){return this.toObject()}}},{defaultAmount:0,defaultCurrency:"USD",defaultPrecision:2},r,o);e.default={props:["resourceName","resourceId","field"],data:function(){return{currentDiscount:null,form:{type:"amount",value:null,duration:"once",months:null},formErrors:{}}},computed:{entityName:function(){return this.resourceName.slice(0,-1)}},mounted:function(){this.getCurrentDiscountForBillable()},methods:{getCurrentDiscountForBillable:function(){var t=this;this.currentDiscount=null,Nova.request().get("/nova-vendor/nova-spark-discount/"+this.resourceName+"/"+this.resourceId).then(function(e){200===e.status&&(t.currentDiscount=e.data)})},formattedDiscount:function(t){if(t)return t.percent_off?t.percent_off+"%":y({amount:this.calculateAmountOff(t.amount_off),currency:"EUR"}).setLocale("fi").toFormat("$0,0.00")},calculateAmountOff:function(t){return t/100},applyDiscount:function(){var t=this;Nova.request().post("/nova-vendor/nova-spark-discount/"+this.resourceName+"/"+this.resourceId,this.form).then(function(e){t.$toasted.show("The discount has been applied.",{type:"success"}),t.getCurrentDiscountForBillable()}).catch(function(e){e.response.data.errors?(t.$toasted.show("There was a problem submitting the form.",{type:"error"}),t.formErrors=e.response.data.errors||{}):t.$toasted.show(e.response.data.message,{type:"error"})})}}}},function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"mb-8"},[t._m(0),t._v(" "),n("form",{staticClass:"spaced-y-4",attrs:{role:"form"},on:{submit:function(e){return e.preventDefault(),t.applyDiscount(e)}}},[n("div",{staticClass:"card mb-6 py-3 px-6"},[t.currentDiscount?n("div",{staticClass:"px-4 py-2 bg-info text-white rounded inline-block"},["repeating"==t.currentDiscount.duration&&t.currentDiscount.duration_in_months>1?n("span",[t._v("This "+t._s(this.entityName)+" has a discount of "+t._s(t.formattedDiscount(t.currentDiscount))+" for all invoices during the next "+t._s(t.currentDiscount.duration_in_months)+" months.")]):t._e(),t._v(" "),"repeating"==t.currentDiscount.duration&&1==t.currentDiscount.duration_in_months?n("span",[t._v("This "+t._s(this.entityName)+" has a discount of "+t._s(t.formattedDiscount(t.currentDiscount))+" for all invoices during the next month.")]):t._e(),t._v(" "),"forever"==t.currentDiscount.duration?n("span",[t._v("This "+t._s(this.entityName)+" has a discount of "+t._s(t.formattedDiscount(t.currentDiscount))+" forever.")]):t._e(),t._v(" "),"once"==t.currentDiscount.duration?n("span",[t._v("This "+t._s(this.entityName)+" has a discount of "+t._s(t.formattedDiscount(t.currentDiscount))+" for a single invoice.")]):t._e()]):t._e(),t._v(" "),n("div",{staticClass:"flex border-b border-40"},[t._m(1),t._v(" "),n("div",{staticClass:"py-6 px-8 w-1/2"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.form.type,expression:"form.type"}],staticClass:"form-control form-select mb-3 w-full",class:{"border-danger":t.formErrors.type},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.form,"type",e.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"amount"}},[t._v("Amount")]),t._v(" "),n("option",{attrs:{value:"percent"}},[t._v("Percentage")])]),t._v(" "),t.formErrors.type?n("div",{staticClass:"help-text mt-2 text-danger"},[t._v(t._s(t.formErrors.type[0]))]):t._e()])]),t._v(" "),n("div",{staticClass:"flex border-b border-40"},[t._m(2),t._v(" "),n("div",{staticClass:"py-6 px-8 w-1/2"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.value,expression:"form.value"}],staticClass:"w-full form-control form-input form-input-bordered",class:{"border-danger":t.formErrors.value},attrs:{type:"number"},domProps:{value:t.form.value},on:{input:function(e){e.target.composing||t.$set(t.form,"value",e.target.value)}}}),t._v(" "),t.formErrors.value?n("div",{staticClass:"help-text mt-2 text-danger"},[t._v(t._s(t.formErrors.value[0]))]):t._e()])]),t._v(" "),n("div",{staticClass:"flex border-b border-40",class:{"remove-bottom-border":"repeating"!==t.form.duration}},[t._m(3),t._v(" "),n("div",{staticClass:"py-6 px-8 w-1/2"},[n("select",{directives:[{name:"model",rawName:"v-model",value:t.form.duration,expression:"form.duration"}],staticClass:"form-control form-select mb-3 w-full",class:{"border-danger":t.formErrors.duration},on:{change:function(e){var n=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.$set(t.form,"duration",e.target.multiple?n:n[0])}}},[n("option",{attrs:{value:"once"}},[t._v("Once")]),t._v(" "),n("option",{attrs:{value:"forever"}},[t._v("Forever")]),t._v(" "),n("option",{attrs:{value:"repeating"}},[t._v("Multiple Months")])]),t._v(" "),t.formErrors.duration?n("div",{staticClass:"help-text mt-2 text-danger"},[t._v(t._s(t.formErrors.duration[0]))]):t._e()])]),t._v(" "),"repeating"===t.form.duration?n("div",{staticClass:"flex border-b border-40 remove-bottom-border"},[t._m(4),t._v(" "),n("div",{staticClass:"py-6 px-8 w-1/2"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.form.months,expression:"form.months"}],staticClass:"w-full form-control form-input form-input-bordered",class:{"border-danger":t.formErrors.months},attrs:{type:"number"},domProps:{value:t.form.months},on:{input:function(e){e.target.composing||t.$set(t.form,"months",e.target.value)}}}),t._v(" "),t.formErrors.months?n("div",{staticClass:"help-text mt-2 text-danger"},[t._v(t._s(t.formErrors.months[0]))]):t._e()])]):t._e()]),t._v(" "),t._m(5)])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"flex items-center mb-3"},[e("h1",{staticClass:"flex-no-shrink text-90 font-normal text-2xl"},[this._v("Stripe Discount")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"w-1/5 px-8 py-6"},[e("label",{staticClass:"inline-block text-80 pt-2 leading-tight",attrs:{for:"type"}},[this._v("\n                        Type\n                        "),e("span",{staticClass:"text-danger text-sm"},[this._v("*")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"w-1/5 px-8 py-6"},[e("label",{staticClass:"inline-block text-80 pt-2 leading-tight",attrs:{for:"value"}},[this._v("\n                        Percent / Amount\n                        "),e("span",{staticClass:"text-danger text-sm"},[this._v("*")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"w-1/5 px-8 py-6"},[e("label",{staticClass:"inline-block text-80 pt-2 leading-tight",attrs:{for:"duration"}},[this._v("\n                        Duration\n                        "),e("span",{staticClass:"text-danger text-sm"},[this._v("*")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"w-1/5 px-8 py-6"},[e("label",{staticClass:"inline-block text-80 pt-2 leading-tight",attrs:{for:"months"}},[this._v("\n                        Months\n                        "),e("span",{staticClass:"text-danger text-sm"},[this._v("*")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"flex justify-end items-center"},[e("button",{staticClass:"btn btn-default btn-primary inline-flex items-center relative",attrs:{type:"submit"}},[e("span",{},[this._v("Apply Discount")])])])}]}},function(t,e){}]);